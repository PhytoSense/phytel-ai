<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PhytoBot — Phytelix</title>
    <link rel="shortcut icon" href="phytelix-removebg-preview.png" type="image/x-icon">
    <style>
      :root{
        --accent: #10b981;
        --accent-dark: #0ea06e;
        --bg: #052e1f;
        --card: #063826;
        --muted: #9fbfad;
        --panel: #0b3f2f;
        --glass: rgba(255,255,255,0.03);
      }
      *{box-sizing:border-box}
      body{margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial; background:linear-gradient(180deg,#03271e 0%, #083225 100%);color:#e6fff4;height:100vh;display:flex}
      .sidebar{width:280px;background:linear-gradient(180deg,var(--panel), #07372a);border-right:1px solid rgba(255,255,255,0.04);padding:16px;display:flex;flex-direction:column;gap:12px}
      .brand{display:flex;gap:12px;align-items:center}
      .brand img{width:44px;height:44px;border-radius:10px}
  .brand h1{font-size:18px;margin:0}
  .brand-sub{font-size:12px;color:var(--muted)}
  .profile-area{margin-top:6px}
  .profile-input{width:100%;margin-top:6px;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit}
  .profile-file{margin-top:6px;width:100%}
  .label-block{display:block;margin-top:8px}
      .new-chat{background:var(--accent);color:#052e1f;border:none;padding:10px;border-radius:10px;cursor:pointer}
      .chats{flex:1;overflow:auto;padding-top:8px}
      .chat-item{padding:8px;border-radius:8px;margin-bottom:8px;background:transparent;color:var(--muted);cursor:pointer}
      .chat-item.active{background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));color:#fff}
      .footer-note{font-size:12px;color:var(--muted);text-align:center}

      .main{flex:1;display:flex;flex-direction:column;height:100vh}
      .header{padding:16px;border-bottom:1px solid rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:space-between}
      .header h2{margin:0}
      .content{display:flex;flex:1;overflow:hidden}

      .messages-wrap{flex:1;display:flex;flex-direction:column}
      .messages{flex:1;overflow:auto;padding:20px;gap:12px;display:flex;flex-direction:column;background:linear-gradient(180deg, rgba(0,0,0,0.02), transparent)}
      .msg{max-width:72%;padding:12px;border-radius:12px;line-height:1.3}
      .msg.user{align-self:flex-end;background:linear-gradient(180deg,var(--accent),var(--accent-dark));color:#052e16}
      .msg.assistant{align-self:flex-start;background:rgba(255,255,255,0.03);color:#e6fff4;border:1px solid rgba(255,255,255,0.02)}
      .msg .meta{font-size:12px;color:var(--muted);margin-bottom:6px}
      .controls{display:flex;gap:8px;padding:12px;border-top:1px solid rgba(255,255,255,0.03);background:rgba(0,0,0,0.02)}
      textarea{flex:1;border-radius:10px;border:1px solid rgba(255,255,255,0.04);padding:10px;background:transparent;color:inherit;min-height:56px;resize:none}
      button.primary{background:var(--accent);border:none;color:#052e16;padding:10px 14px;border-radius:10px;cursor:pointer}

  .settings{width:320px;border-left:1px solid rgba(255,255,255,0.03);padding:16px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent)}
  .mem-textarea{width:100%;background:transparent;color:inherit;border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:8px}
  .save-mem-wrap{margin-top:12px}
  .mt-8{margin-top:8px}
  .w-full{width:100%}
  .sep{margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)}
  .about-text{margin-top:8px;font-size:13px;color:var(--muted)}
      .settings h3{margin-top:0}
      .setting-row{display:flex;align-items:center;justify-content:space-between;padding:8px 0}
      .small{font-size:13px;color:var(--muted)}
      .mem-toggle{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:6px 10px;border-radius:8px;color:inherit;cursor:pointer}

      .inline-actions{display:inline-flex;gap:8px;margin-left:8px}
      .link{color:var(--accent);cursor:pointer}
  .section-title{margin-top:8px}
  .file-input{margin-top:8px;width:100%}
  .image-preview{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap}
  .detection-result{margin-top:8px;color:var(--muted)}
  .sep{margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)}
  
  /* Crop selector styling */
  .crop-selector{
    width:100%;
    background:transparent;
    color:inherit;
    border:1px solid rgba(255,255,255,0.04);
    padding:8px;
    border-radius:8px;
    margin-top:8px;
    margin-bottom:8px;
  }
  .crop-selector option{
    background:#052e1f;
    color:#e6fff4;
  }

    </style>
  </head>
  <body>
    <aside class="sidebar">
      <div class="brand">
        <img src="phytobot.png" alt="logo">
        <div>
          <h1>PhytoBot</h1>
          <div class="brand-sub">Crop assistant — Local only</div>
        </div>
      </div>
      <button class="new-chat" id="newChatBtn">+ New Chat</button>
      <div class="chats" id="chatList"></div>
      <div class="footer-note">Saved locally • Use for demos</div>
    </aside>

    <main class="main">
      <div class="header">
        <h2 id="chatTitle">PhytoBot</h2>
        <div>
          <button id="renameBtn" class="link">Rename</button>
          <button id="deleteChat" class="link">Delete</button>
        </div>
      </div>
      <div class="content">
        <div class="messages-wrap">
          <div id="messages" class="messages"></div>
          <div class="controls">
            <textarea id="user-input" placeholder="Ask PhytoBot... (Shift+Enter for newline)"></textarea>
            <button id="send-button" class="primary">Send</button>
          </div>
        </div>
        <div id="profileArea" class="profile-area">
          <label for="profileName" class="small">Your name</label>
          <input id="profileName" placeholder="Anonymous" class="profile-input" />
    <label for="profileImageUpload" class="small label-block">Profile image (optional)</label>
          <input type="file" id="profileImageUpload" accept="image/*" class="profile-file" />
        </div>

        <aside class="settings" id="settings">
          <h3>Settings & Memory</h3>
          <p class="small">Memory stores a short context prompt that will be prepended to each assistant request.</p>
          <label for="memoryInput" class="small">Per-chat memory (optional)</label>
          <div class="mt-8">
            <textarea id="memoryInput" rows="6" class="mem-textarea"></textarea>
          </div>
          <div class="setting-row">
            <div class="small">Enable memory</div>
            <button id="memToggle" class="mem-toggle">Toggle</button>
          </div>
          <div class="save-mem-wrap">
            <button id="saveMem" class="primary w-full">Save Memory</button>
          </div>
          <hr class="sep">
          <h3 class="section-title">Image Detection</h3>
          <p class="small">Select crop type and upload a leaf photo for disease analysis.</p>
          <label for="crop-model-select" class="small">Select crop model</label>
          <select id="crop-model-select" class="crop-selector">
            <option value="autodetect">Auto-detect (All crops)</option>
            <option value="corn">Corn/Maize</option>
            <option value="tomato">Tomato</option>
            <option value="cassava">Cassava</option>
            <option value="cacao">Cacao/Cocoa</option>
            <option value="guava">Guava</option>
            <option value="apple">Apple</option>
            <option value="banana">Banana</option>
          </select>
          <label for="image-upload-chat" class="small">Upload images</label>
          <input id="image-upload-chat" type="file" accept="image/*" multiple class="file-input" />
          <div id="chat-image-preview" class="image-preview"></div>
          <div id="chat-detection-result" class="detection-result"></div>
          <hr class="sep">
          <div class="small">About</div>
          <div class="about-text">PhytoBot keeps your chats locally in the browser. Edit, rename or delete as needed.</div>
        </aside>
      </div>
    </main>

    <!-- TeachableMachine library -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    
    <script src="chat.js"></script>

    <!-- App config and integrations -->
    <script src="config.js"></script>
    <script src="firebase.js"></script>
    <script src="supabase.js"></script>
    <script src="integrations.js"></script>
  </body>
</html>
